<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro"
       name="mp500" >
  <xacro:include filename="$(find mp500_description)/urdf/mp500.gazebo"/>
  <xacro:property name="M_PI" value="3.1415926535897931" />
  <xacro:property name="safety_offset" value="0.02"/>

<!-- Materials -->


<!--++++++++++++++++++++++++++++++base_link++++++++++++++++++++++++++++++++++++++++++++++++++++--> 

  <link name="base_link">
       <inertial>
          <mass value="25.67" />
	    <origin xyz="0.15 0 0.2" rpy="0 0 0"/>
	<inertia ixx="1.08" ixy="0.0" ixz="0.0" iyy="1.08" iyz="0.0" izz="1.23" />
       </inertial>

       <visual name='body'>
	<origin xyz="0 0 0.09" rpy="0 0 -1.57" /><!-- for STL -->
              <geometry>
                 <mesh filename="package://mp500_description/meshes/MP500-BODY.STL" scale="0.01 0.01 0.01"/>
	      </geometry>
        <material name="Neobotix/Grey" />
       </visual>
      <collision name='body_collision'>
        <origin xyz="0.1 0 0.2" rpy="0 0 -1.57" />
        <geometry>
          <box size="0.400 0.400 0.250"/>
        </geometry>
      </collision>
      <visual>
	  <origin xyz="0.45 0 0.01" rpy="0 0 0" />
	  <geometry>
            <sphere radius="0.005"/>    
	  </geometry>
	 <material name="Neobotix/Grey" />
	</visual>

        <collision>
	  <origin xyz="0.45 0 0.01" rpy="0 0 0" />
	  <geometry>
             <sphere radius="0.005"/>
	  </geometry>
	</collision>
    </link>

<!--+++++++++++++++++++wheel_left_link++++++++++++++++++++++++--> 
   <link name="wheel_left_link" type="wheel">
      <inertial>
      	<mass value="1.0" />
     	   <origin xyz="0 0 0" rpy="0 0 0" />
      	 <inertia ixx="0.0045" ixy="0" ixz="0" iyy="0.0078" iyz="0" izz="0.0045" />
      </inertial>

      <visual>
     	<origin xyz="0 0 0" rpy="0 0 -1.57" />
     	<geometry>
		<mesh filename="package://mp500_description/meshes/MP500-WHEEL.STL" scale="0.01 0.01 0.01" /> 
     	</geometry>
     	<material name="Neobotix/Black" />
      </visual>

    <collision>
     	<origin xyz="0 0 0" rpy="0 1.57 -1.57" />
     	<geometry>
        	<cylinder radius="0.125" length="0.085"/>
     	</geometry>
    </collision>
			
</link>

<!--+++++++++++++++++++wheel_left_joint++++++++++++++++++++++++--> 
  <joint name="wheel_left_joint" type="revolute">
     <origin xyz="0 0.255 0.13" rpy="0 0 0" />
    	<axis xyz="0 1 0"/>
    	<limit effort="10000.0" lower="-1e+16" upper="1e+16" velocity="11.6"/>
    	<joint_properties damping="0.0" friction="0.0" />
    	<parent link="base_link" />
     <child link="wheel_left_link" />
    </joint>

<!--+++++++++++++++++++wheel_right_link++++++++++++++++++++++++--> 

  <link name="wheel_right_link" type="wheel">
     <inertial>
      <mass value="1" />
      <origin xyz="0 0 0" rpy="0 0 0" />
		  <!--inertia ixx="0.0051" ixy="0" ixz="0" iyy="0.0051" iyz="0" izz="0.009" /-->
       <inertia ixx="0.0045" ixy="0" ixz="0" iyy="0.0078" iyz="0" izz="0.0045" />
     </inertial>

     <visual>
	<origin xyz="0 0 0" rpy="0 0 -1.57" />
	<geometry>
	 <mesh filename="package://mp500_description/meshes/MP500-WHEEL.STL" scale="0.01 0.01 0.01" />
	</geometry>
	<material name="Neobotix/Black" />
     </visual>

     <collision>
	<origin xyz="0 0 0" rpy="0 1.57 -1.57" />
	<geometry>
		<cylinder radius="0.125" length="0.085"/>
	</geometry>
    </collision>
   </link>

<!--+++++++++++++++++++wheel_right_joint++++++++++++++++++++++++--> 
   <joint name="wheel_right_joint" type="revolute">
     <origin xyz="0 -0.255 0.13" rpy="0 0 0" />
    	<axis xyz="0 1 0"/>
    	<limit effort="10000.0" lower="-1e+16" upper="1e+16" velocity="11.6"/>
    	<joint_properties damping="0.0" friction="0.0" />
    	<parent link="base_link" />
    	<child link="wheel_right_link" />
    </joint>

<transmission name="wheel_left_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_left_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
    <actuator name="wheel_left_motor">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>0.09</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="wheel_right_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_right_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
    <actuator name="wheel_right_motor">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>0.09</mechanicalReduction>
    </actuator>
  </transmission>


 <gazebo>
    <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
      <robotNamespace>/mp500</robotNamespace>		  
      <alwaysOn>true</alwaysOn>
      <updateRate>100</updateRate>
      <leftJoint>wheel_left_joint</leftJoint>
      <rightJoint>wheel_right_joint</rightJoint>
      <wheelSeparation>0.51</wheelSeparation>
      <wheelDiameter>0.125</wheelDiameter>
      <torque>45</torque>
      <commandTopic>/mp500/mobile_base_controller/cmd_vel</commandTopic>
      <odometryTopic>odom</odometryTopic>
      <odometryFrame>map</odometryFrame>
      <robotBaseFrame>base_link</robotBaseFrame>    
      <legacyMode>false</legacyMode>
      <rosDebugLevel>Debug</rosDebugLevel>
      <publishWheelTF>true</publishWheelTF>
      <publishWheelJointState>true</publishWheelJointState>
      <wheelAcceleration>0.01</wheelAcceleration>
      <wheelTorque>50</wheelTorque>
      <publishTf>1</publishTf>
      <odometrySource>encoder</odometrySource>
    </plugin>

    <!--plugin name="ros_control" filename="libhwi_switch_gazebo_ros_control.so"-->
     <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
        <!--plugin name="ros_control" filename="libhwi_switch_gazebo_ros_control.so"-->
        <robotNamespace>mp500</robotNamespace>
        <filterJointsParam>joint_names</filterJointsParam>
     </plugin>
    <!--plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
    <jointName>wheel_left_joint, wheel_right_joint</jointName>
    </plugin>>-->
  </gazebo>


</robot>
